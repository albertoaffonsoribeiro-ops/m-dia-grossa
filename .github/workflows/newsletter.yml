name: ğŸ“° Gerar Newsletter DiÃ¡ria

on:
  schedule:
    # Roda todo dia Ã s 7h no horÃ¡rio de BrasÃ­lia (10h UTC)
    - cron: "0 10 * * *"

  # Permite rodar manualmente pelo painel do GitHub
  workflow_dispatch:

jobs:
  gerar:
    runs-on: ubuntu-latest

    steps:
      # 1. Baixa o cÃ³digo do repositÃ³rio
      - name: ğŸ“¥ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      # 2. Instala o Python
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # 3. Instala as dependÃªncias
      - name: ğŸ“¦ Instalar dependÃªncias
        run: pip install anthropic feedparser

      # 4. Roda o script que gera a newsletter
      - name: âœï¸ Gerar newsletter
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: python gerar_newsletter.py

      # 5. Sobe o index.html gerado de volta pro GitHub
      - name: ğŸš€ Publicar no GitHub
        run: |
          git config user.name "newsletter-bot"
          git config user.email "bot@midiagrossa.com"
          git add index.html edicoes/
          git diff --staged --quiet || git commit -m "ğŸ“° Newsletter $(date +'%Y-%m-%d')"
          git push
